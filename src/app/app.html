<div class="max-w-7xl mx-auto">
  <header class="flex flex-col sm:flex-row justify-between items-center mb-8">
    <div class="flex items-center space-x-4">
      <!-- <img alt="Cypher System Logo" class="h-16"
        src="https://cypher-system.com/wp-content/uploads/revslider/cs-2/Cypher-Logo-v1-white-dark-glow.png" /> -->
      <h1 class="font-display text-2xl sm:text-4xl font-bold text-gray-900 dark:text-white uppercase tracking-wider">
        Cypher System</h1>
      <!-- Save Button -->
       <div>
         <button class="p-2 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" (click)="saveSheet()" style="height: 40px;">
            @if(!changeDanger) {
              <span class="material-icons-outlined text-green-500">check_circle</span>
            } @else {
              <span class="material-icons-outlined">save</span>
            }
           <!-- <span class="material-icons-outlined">save</span> -->
         </button>
       </div>
       <!-- Export Button -->
        <div class="ml-2">
          <button class="p-2 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" (click)="exportSheet()" style="height: 40px;">
            <span class="material-icons-outlined">file_download</span>
          </button>
        </div>
        <!-- Import Button -->
        <div class="ml-2">
          <button class="p-2 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" (click)="importSheet()" style="height: 40px;">
            <span class="material-icons-outlined">file_upload</span>
          </button>
        </div>
        <!-- Reset Button -->
        <div class="ml-2">
          <button class="p-2 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" (click)="resetSheet()" style="height: 40px;">
            <span class="material-icons-outlined">restore</span>
          </button>
        </div>
    </div>
    <div class="mt-4 sm:mt-0">
      <button class="p-2 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200" (click)="themeToggle()" style="height: 40px;">
        @if (isDarkMode) {
          <span class="material-icons-outlined">dark_mode</span>
        } @else {
          <span class="material-icons-outlined">light_mode</span>
        }
      </button>
    </div>
  </header>
  <main class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <div class="flex flex-col gap-6">

      <!-- Info Block -->
      <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
        <div class="mb-4">
          <label class="font-display text-sm uppercase text-primary font-bold" for="name">Nome</label>
          <input [(ngModel)]="sheet.name"
            class="block w-full mt-1 rounded-md border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-gray-900 dark:text-white"
            id="name" type="text" />
        </div>
        <div class="mb-4">
          <p class="font-display text-sm uppercase text-primary font-bold">É um (a)</p>
          <div class="flex flex-col sm:flex-row sm:items-center mt-1 space-y-2 sm:space-y-0 sm:space-x-2">
            <input [(ngModel)]="sheet.type"
              class="flex-1 w-full rounded-md border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-gray-900 dark:text-white"
              placeholder="Tipo" type="text" />
            <input [(ngModel)]="sheet.descriptor"
              class="flex-1 w-full rounded-md border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-gray-900 dark:text-white"
              placeholder="Descritor" type="text" />
            <span class="hidden sm:block text-gray-500 dark:text-gray-400">que</span>
          </div>
          <input [(ngModel)]="sheet.focus"
            class="block w-full mt-2 rounded-md border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-gray-900 dark:text-white"
            placeholder="Foco" type="text" />
        </div>
        <div>
          <label class="font-display text-sm uppercase text-primary font-bold" for="focus">Flavor</label>
          <input [(ngModel)]="sheet.flavor"
            class="block w-full mt-1 rounded-md border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-gray-900 dark:text-white"
            id="flavor" type="text" />
        </div>
      </div>

      <!-- Tier/Effort/XP Block -->
      <div class="grid grid-cols-3 gap-4">
        <div
          class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 text-center">
          <label class="font-display text-sm uppercase text-primary font-bold" for="tier">Tier</label>
          <input
            class="text-2xl font-bold w-full text-center mt-1 bg-transparent border-none p-0 focus:ring-0 text-gray-900 dark:text-white"
            id="tier" type="number" [(ngModel)]="sheet.tier"/>
        </div>
        <div
          class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 text-center">
          <label class="font-display text-sm uppercase text-primary font-bold" for="effort">Esforço</label>
          <input [(ngModel)]="sheet.effort"
            class="text-2xl font-bold w-full text-center mt-1 bg-transparent border-none p-0 focus:ring-0 text-gray-900 dark:text-white"
            id="effort" type="number" />
        </div>
        <div
          class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 text-center">
          <label class="font-display text-sm uppercase text-primary font-bold" for="xp">XP</label>
          <input [(ngModel)]="sheet.xp"
            class="text-2xl font-bold w-full text-center mt-1 bg-transparent border-none p-0 focus:ring-0 text-gray-900 dark:text-white"
            id="xp" type="number" />
        </div>
      </div>

      <!-- Attributes Block -->
      <div class="grid grid-cols-3 gap-4">
        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 flex flex-row">
          <h3 class="font-display text-center uppercase text-primary font-bold mr-3" style="writing-mode: sideways-lr;">Potência</h3>
          <div class="space-y-2">
            <input [(ngModel)]="sheet.pools.mig.curr"
              class="w-full text-center rounded-md border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-gray-900 dark:text-white"
              placeholder="Atual" type="number" />
            <input [(ngModel)]="sheet.pools.mig.max" 
              class="w-full text-center rounded-md border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-gray-900 dark:text-white"
              placeholder="Máx" type="number" />
            <hr class="border-gray-300 dark:border-gray-600" />
            <input [(ngModel)]="sheet.pools.mig.edge"
              class="w-full text-center rounded-md border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 bg-primary/10 text-primary dark:bg-primary/20 dark:text-indigo-300 font-semibold rounded-md hover:bg-primary/20 dark:hover:bg-primary/30"
              placeholder="Edge" type="number" />
          </div>
        </div>
        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 flex flex-row">
          <h3 class="font-display text-center uppercase text-primary font-bold mr-3" style="writing-mode: sideways-lr;">Velocidade</h3>
          <div class="space-y-2">
            <input [(ngModel)]="sheet.pools.spd.curr"
              class="w-full text-center rounded-md border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-gray-900 dark:text-white"
              placeholder="Atual" type="number" />
            <input [(ngModel)]="sheet.pools.spd.max" 
              class="w-full text-center rounded-md border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-gray-900 dark:text-white"
              placeholder="Máx" type="number" />
            <hr class="border-gray-300 dark:border-gray-600" />
            <input [(ngModel)]="sheet.pools.spd.edge"
              class="w-full text-center rounded-md border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 bg-primary/10 text-primary dark:bg-primary/20 dark:text-indigo-300 font-semibold rounded-md hover:bg-primary/20 dark:hover:bg-primary/30"
              placeholder="Edge" type="number" />
          </div>
        </div>
        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 flex flex-row">
          <h3 class="font-display text-center uppercase text-primary font-bold mr-3" style="writing-mode: sideways-lr;">Intelecto</h3>
          <div class="space-y-2">
            <input [(ngModel)]="sheet.pools.int.curr"
              class="w-full text-center rounded-md border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-gray-900 dark:text-white"
              placeholder="Atual" type="number" />
            <input [(ngModel)]="sheet.pools.int.max" 
              class="w-full text-center rounded-md border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-gray-900 dark:text-white"
              placeholder="Máx" type="number" />
            <hr class="border-gray-300 dark:border-gray-600" />
            <input [(ngModel)]="sheet.pools.int.edge"
              class="w-full text-center rounded-md border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 bg-primary/10 text-primary dark:bg-primary/20 dark:text-indigo-300 font-semibold rounded-md hover:bg-primary/20 dark:hover:bg-primary/30"
              placeholder="Edge" type="number" />
          </div>
        </div>
      </div>

      <!-- Recovery / Damage Block -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
          <h3 class="font-display uppercase text-primary font-bold mb-3">Recuperação <span
              class="text-sm font-normal text-gray-500 dark:text-gray-400">1d6 + {{sheet.tier}}</span></h3>
          <div class="flex flex-row gap-2">
            <div class="space-y-2 text-sm text-gray-700 dark:text-gray-300">
              <div class="flex items-center"><input [(ngModel)]="sheet.recovery[0]"
                  class="h-4 w-4 rounded border-gray-300 dark:border-gray-600 text-primary focus:ring-primary bg-gray-100 dark:bg-gray-900 dark:ring-offset-gray-800"
                  type="checkbox" /> <span class="ml-2">1 Ação</span></div>
              <div class="flex items-center"><input [(ngModel)]="sheet.recovery[2]"
                  class="h-4 w-4 rounded border-gray-300 dark:border-gray-600 text-primary focus:ring-primary bg-gray-100 dark:bg-gray-900 dark:ring-offset-gray-800"
                  type="checkbox" /> <span class="ml-2">1 Hora</span></div>
            </div>
            <div class="space-y-2 text-sm text-gray-700 dark:text-gray-300">
              <div class="flex items-center"><input [(ngModel)]="sheet.recovery[1]"
                  class="h-4 w-4 rounded border-gray-300 dark:border-gray-600 text-primary focus:ring-primary bg-gray-100 dark:bg-gray-900 dark:ring-offset-gray-800"
                  type="checkbox" /> <span class="ml-2">10 Min</span></div>
              <div class="flex items-center"><input [(ngModel)]="sheet.recovery[3]"
                  class="h-4 w-4 rounded border-gray-300 dark:border-gray-600 text-primary focus:ring-primary bg-gray-100 dark:bg-gray-900 dark:ring-offset-gray-800"
                  type="checkbox" /> <span class="ml-2">10 Horas</span></div>
            </div>
          </div>
        </div>
        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
          <h3 class="font-display uppercase text-primary font-bold mb-3">Marcador de Dano</h3>
          <div class="space-y-2 text-sm">
            <label class="flex items-start">
              <input [(ngModel)]="sheet.damage[0]"
                class="h-4 w-4 mt-0.5 rounded border-gray-300 dark:border-gray-600 text-primary focus:ring-primary bg-gray-100 dark:bg-gray-900 dark:ring-offset-gray-800"
                type="checkbox" />
              <div class="ml-2">
                <span class="font-semibold text-gray-800 dark:text-gray-200">Prejudicado</span>
              </div>
            </label>
            <label class="flex items-start">
              <input [(ngModel)]="sheet.damage[1]"
                class="h-4 w-4 mt-0.5 rounded border-gray-300 dark:border-gray-600 text-primary focus:ring-primary bg-gray-100 dark:bg-gray-900 dark:ring-offset-gray-800"
                type="checkbox" />
              <div class="ml-2">
                <span class="font-semibold text-gray-800 dark:text-gray-200">Debilitado</span>
              </div>
            </label>
          </div>
        </div>
      </div>

      <!-- Habilidades. -->
       <!-- TODO: Mudar para o Padrão das Cifras -->
      <div
        class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 flex-grow">
        <div class="flex justify-between items-center mb-2">
          <h3 class="font-display uppercase text-primary font-bold mb-2">Habilidades Especiais</h3>
        </div>
        <div class="flex-grow overflow-y-auto h-76 pr-2 space-y-2 border-b border-gray-200 dark:border-gray-700 pb-2 mb-2">
        @for (hab of sheet.abilities; track $index) {
          <div class="grid grid-cols-12 gap-2">
            <textarea [(ngModel)]="sheet.abilities[$index]" 
              class="col-span-11 block w-full h-20 rounded-md border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-gray-900 dark:text-white text-sm" style="resize: none;"
              placeholder="Descrição da habilidade"></textarea>
            <div class="flex flex-col items-center justify-around">
              <button type="button" class="col-span-1 text-body bg-transparent hover:bg-neutral-tertiary hover:text-heading rounded-base text-sm w-4 h-4 ms-auto inline-flex justify-center items-center" data-modal-hide="default-modal" (click)="moveAbility($index,-1)">
                <svg class="w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"
                    width="24" height="24" fill="none" viewBox="0 0 24 24">
                  <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                        stroke-width="2" d="M18 15 12 9 6 15"/>
                </svg>

                <span class="sr-only">Remover</span>
              </button>
              <button type="button" class="col-span-1 text-body bg-transparent hover:bg-neutral-tertiary hover:text-heading rounded-base text-sm w-4 h-4 ms-auto inline-flex justify-center items-center" data-modal-hide="default-modal" (click)="removeAbility($index)">
                <svg class="w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18 17.94 6M18 18 6.06 6"/></svg>
                <span class="sr-only">Remover</span>
              </button>
              <button type="button" class="col-span-1 text-body bg-transparent hover:bg-neutral-tertiary hover:text-heading rounded-base text-sm w-4 h-4 ms-auto inline-flex justify-center items-center" data-modal-hide="default-modal" (click)="moveAbility($index,1)">
                <svg class="w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"
                    width="24" height="24" fill="none" viewBox="0 0 24 24">
                  <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                        stroke-width="2" d="M6 9 12 15 18 9"/>
                </svg>

                <span class="sr-only">Remover</span>
              </button>
            </div>
          </div>
          }
        </div>
        <button (click)="addAbility()"
          class="w-full mt-2 text-sm bg-primary/10 text-primary dark:bg-primary/20 dark:text-indigo-300 font-semibold py-2 px-4 rounded-md hover:bg-primary/20 dark:hover:bg-primary/30 transition-colors">Nova Habilidade</button>
        <!-- <textarea [(ngModel)]="sheet.abilities[0]"
          class="block w-full h-48 rounded-md border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-gray-900 dark:text-white"
          placeholder="Suas habilidades especiais aqui"></textarea> -->
      </div>
    </div>

    <!-- Column 2 -->
    <div class="flex flex-col gap-6">
      
      <!-- Advancement Block -->
      <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
        <div class="flex flex-row justify-between">
          <h3 class="font-display uppercase text-primary font-bold mb-3">Avanços</h3>
          <button class="mb-2 text-xs bg-primary/10 text-primary dark:bg-primary/20 dark:text-indigo-300 font-semibold px-4 rounded-md hover:bg-primary/20 dark:hover:bg-primary/30 transition-colors" [disabled]="countTrue(sheet.advancements) < 4" (click)="upTier()">{{countTrue(sheet.advancements) < 4 ? countTrue(sheet.advancements) + "/4" : "+ Tier "}}</button>
        </div>
        <div
          class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-4 text-xs text-center text-gray-600 dark:text-gray-300">
          <label class="flex flex-col items-center space-y-2"><input [(ngModel)]="sheet.advancements[0]"
              class="h-5 w-5 rounded border-gray-300 dark:border-gray-600 text-primary focus:ring-primary bg-gray-100 dark:bg-gray-900 dark:ring-offset-gray-800"
              type="checkbox" /><span>+4 nas Reservas</span></label>
          <label class="flex flex-col items-center space-y-2"><input [(ngModel)]="sheet.advancements[1]"
              class="h-5 w-5 rounded border-gray-300 dark:border-gray-600 text-primary focus:ring-primary bg-gray-100 dark:bg-gray-900 dark:ring-offset-gray-800"
              type="checkbox" /><span>+1 em Edge</span></label>
          <label class="flex flex-col items-center space-y-2"><input [(ngModel)]="sheet.advancements[2]"
              class="h-5 w-5 rounded border-gray-300 dark:border-gray-600 text-primary focus:ring-primary bg-gray-100 dark:bg-gray-900 dark:ring-offset-gray-800"
              type="checkbox" /><span>+1 em Esforço</span></label>
          <label class="flex flex-col items-center space-y-2"><input [(ngModel)]="sheet.advancements[3]"
              class="h-5 w-5 rounded border-gray-300 dark:border-gray-600 text-primary focus:ring-primary bg-gray-100 dark:bg-gray-900 dark:ring-offset-gray-800"
              type="checkbox" /><span>Nova Perícia</span></label>
          <label class="flex flex-col items-center space-y-2"><input [(ngModel)]="sheet.advancements[4]"
              class="h-5 w-5 rounded border-gray-300 dark:border-gray-600 text-primary focus:ring-primary bg-gray-100 dark:bg-gray-900 dark:ring-offset-gray-800"
              type="checkbox" /><span>Outro Avanço</span></label>
        </div>
      </div>
      <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
        <h3 class="mb-3 font-display uppercase text-primary font-bold">Perícias • Potência</h3>
        <!-- <p class="text-xs text-gray-500 dark:text-gray-400 mb-2">T = treinado, S = especialista, I = inabilidade</p> -->
        <div class="overflow-y-auto h-32 pr-2 space-y-2 border-b border-gray-200 dark:border-gray-700 pb-2 mb-2">
          @for (skill of sheet.skills.mig; track $index) {
            <div class="flex items-center space-x-2">
              <input [(ngModel)]="skill.name"
                class="flex-grow rounded-md text-sm border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-gray-900 dark:text-white"
                placeholder="Nome da Perícia" type="text" />
              <select [(ngModel)]="skill.grade"
                class="text-center rounded-md text-sm border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-gray-900 dark:text-white"
                placeholder="T" type="text">
                <option value="T">Treinado</option>
                <option value="E">Especialista</option>
                <option value="I">Inabilidade</option>
              </select>
              <button type="button" class="text-body bg-transparent hover:bg-neutral-tertiary hover:text-heading rounded-base text-sm w-4 h-4 ms-auto inline-flex justify-center items-center" data-modal-hide="default-modal" (click)="removeSkill('mig',$index)">
                  <svg class="w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18 17.94 6M18 18 6.06 6"/></svg>
                  <span class="sr-only">Remover</span>
              </button>
            </div>
          }
        </div>
        <button (click)="addSkill('mig')"
          class="w-full mt-2 text-sm bg-primary/10 text-primary dark:bg-primary/20 dark:text-indigo-300 font-semibold py-2 px-4 rounded-md hover:bg-primary/20 dark:hover:bg-primary/30 transition-colors">Nova Perícia</button>
      </div>
      <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
        <h3 class="mb-3 font-display uppercase text-primary font-bold">Perícias • Velocidade</h3>
        <!-- <p class="text-xs text-gray-500 dark:text-gray-400 mb-2">T = treinado, S = especialista, I = inabilidade</p> -->
        <div class="overflow-y-auto h-32 pr-2 space-y-2 border-b border-gray-200 dark:border-gray-700 pb-2 mb-2">
          @for (skill of sheet.skills.spd; track $index) {
            <div class="flex items-center space-x-2">
              <input [(ngModel)]="skill.name"
                class="flex-grow rounded-md text-sm border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-gray-900 dark:text-white"
                placeholder="Nome da Perícia" type="text" />
              <select [(ngModel)]="skill.grade"
                class="flex-grow text-center rounded-md text-sm border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-gray-900 dark:text-white"
                placeholder="T" type="text">
                <option value="T">Treinado</option>
                <option value="E">Especialista</option>
                <option value="I">Inabilidade</option>
              </select>
              <button type="button" class="text-body bg-transparent hover:bg-neutral-tertiary hover:text-heading rounded-base text-sm w-4 h-4 ms-auto inline-flex justify-center items-center" data-modal-hide="default-modal" (click)="removeSkill('spd',$index)">
                  <svg class="w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18 17.94 6M18 18 6.06 6"/></svg>
                  <span class="sr-only">Remover</span>
              </button>
            </div>
          }
        </div>
        <button (click)="addSkill('spd')"
          class="w-full mt-2 text-sm bg-primary/10 text-primary dark:bg-primary/20 dark:text-indigo-300 font-semibold py-2 px-4 rounded-md hover:bg-primary/20 dark:hover:bg-primary/30 transition-colors">Nova Perícia</button>
      </div>
      <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
        <h3 class="mb-3 font-display uppercase text-primary font-bold">Perícias • Intelecto</h3>
        <!-- <p class="text-xs text-gray-500 dark:text-gray-400 mb-2">T = treinado, S = especialista, I = inabilidade</p> -->
        <div class="overflow-y-auto h-32 pr-2 space-y-2 border-b border-gray-200 dark:border-gray-700 pb-2 mb-2">
          @for (skill of sheet.skills.int; track $index) {
            <div class="flex items-center space-x-2">
              <input [(ngModel)]="skill.name"
                class="flex-grow rounded-md text-sm border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-gray-900 dark:text-white"
                placeholder="Nome da Perícia" type="text" />
              <select [(ngModel)]="skill.grade"
                class="flex-grow text-center rounded-md text-sm border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-gray-900 dark:text-white"
                placeholder="T" type="text">
                <option value="T">Treinado</option>
                <option value="E">Especialista</option>
                <option value="I">Inabilidade</option>
              </select>
              <button type="button" class="text-body bg-transparent hover:bg-neutral-tertiary hover:text-heading rounded-base text-sm w-4 h-4 ms-auto inline-flex justify-center items-center" data-modal-hide="default-modal" (click)="removeSkill('int',$index)">
                  <svg class="w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18 17.94 6M18 18 6.06 6"/></svg>
                  <span class="sr-only">Remover</span>
              </button>
            </div>
          }
        </div>
        <button (click)="addSkill('int')"
          class="w-full mt-2 text-sm bg-primary/10 text-primary dark:bg-primary/20 dark:text-indigo-300 font-semibold py-2 px-4 rounded-md hover:bg-primary/20 dark:hover:bg-primary/30 transition-colors">Nova Perícia</button>
      </div>
      <div
        class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 flex-grow">
        <h3 class="font-display uppercase text-primary font-bold">Ataques</h3>
        <div class="mt-2 space-y-2">
          <div class="grid grid-cols-12 gap-2 text-xs text-center font-bold text-gray-500 dark:text-gray-400 pr-4">
            <div class="col-span-7">Nome</div>
            <div class="col-span-2">Mod</div>
            <div class="col-span-2">Dano</div>
            <div class="col-span-1"></div>
          </div>
          <div class="overflow-y-auto h-40 pr-2 space-y-2 border-b border-gray-200 dark:border-gray-700 pb-2 mb-2">
            @for (attack of sheet.attacks; track $index) {
              <div class="grid grid-cols-12 gap-2">
                <input [(ngModel)]="attack.name"
                  class="col-span-7 rounded-md text-sm border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-gray-900 dark:text-white"
                  type="text" />
                <input [(ngModel)]="attack.mod"
                  class="col-span-2 text-center rounded-md text-sm border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-gray-900 dark:text-white"
                  type="text" />
                <input [(ngModel)]="attack.dmg"
                  class="col-span-2 text-center rounded-md text-sm border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-gray-900 dark:text-white"
                  type="text" />
                <div class="w-full flex items-center">
                  <button type="button" class="col-span-1 text-body bg-transparent hover:bg-neutral-tertiary hover:text-heading rounded-base text-sm w-4 h-4 ms-auto inline-flex justify-center items-center" data-modal-hide="default-modal" (click)="removeAttack($index)">
                    <svg class="w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18 17.94 6M18 18 6.06 6"/></svg>
                    <span class="sr-only">Remover</span>
                  </button>
                </div>
              </div>
            }
          </div>
          <button (click)="addAttack()"
            class="w-full mt-2 text-sm bg-primary/10 text-primary dark:bg-primary/20 dark:text-indigo-300 font-semibold py-2 px-4 rounded-md hover:bg-primary/20 dark:hover:bg-primary/30 transition-colors">Novo Ataque</button>
        </div>
      </div>
    </div>
    <div class="flex flex-col gap-6">
      <div
        class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 flex-grow flex flex-col">
        <div class="flex justify-between items-center mb-2">
          <h3 class="font-display uppercase text-primary font-bold">Cifras e Artefatos</h3>
          <div class="flex items-center space-x-2">
            <label class="text-sm font-semibold text-gray-500 dark:text-gray-400" for="limit">Limite:</label>
            <input [(ngModel)]="sheet.cypherLimit"
              class="w-10 text-center rounded-md border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-gray-900 dark:text-white"
              id="limit" type="number" />
          </div>
        </div>
        <div class="flex-grow overflow-y-auto h-64 pr-2 space-y-2 border-b border-gray-200 dark:border-gray-700 pb-2 mb-2">
        @for (cypher of sheet.cyphers; track $index) {
          <div class="grid grid-cols-12 gap-2">
            <textarea [(ngModel)]="sheet.cyphers[$index]" 
              class="col-span-11 block w-full h-20 rounded-md border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-gray-900 dark:text-white text-sm" style="resize: none;"
              placeholder="Descrição da Cifra / Artefato"></textarea>
            <div class="flex flex-col items-center justify-around">
              <button type="button" class="col-span-1 text-body bg-transparent hover:bg-neutral-tertiary hover:text-heading rounded-base text-sm w-4 h-4 ms-auto inline-flex justify-center items-center" data-modal-hide="default-modal" (click)="moveCypher($index,-1)">
                <svg class="w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"
                    width="24" height="24" fill="none" viewBox="0 0 24 24">
                  <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                        stroke-width="2" d="M18 15 12 9 6 15"/>
                </svg>

                <span class="sr-only">Remover</span>
              </button>
              <button type="button" class="col-span-1 text-body bg-transparent hover:bg-neutral-tertiary hover:text-heading rounded-base text-sm w-4 h-4 ms-auto inline-flex justify-center items-center" data-modal-hide="default-modal" (click)="removeCypher($index)">
                <svg class="w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18 17.94 6M18 18 6.06 6"/></svg>
                <span class="sr-only">Remover</span>
              </button>
              <button type="button" class="col-span-1 text-body bg-transparent hover:bg-neutral-tertiary hover:text-heading rounded-base text-sm w-4 h-4 ms-auto inline-flex justify-center items-center" data-modal-hide="default-modal" (click)="moveCypher($index,1)">
                <svg class="w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"
                    width="24" height="24" fill="none" viewBox="0 0 24 24">
                  <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                        stroke-width="2" d="M6 9 12 15 18 9"/>
                </svg>

                <span class="sr-only">Remover</span>
              </button>
            </div>
          </div>
          }
        </div>
        <button (click)="addCypher()"
          class="w-full mt-2 text-sm bg-primary/10 text-primary dark:bg-primary/20 dark:text-indigo-300 font-semibold py-2 px-4 rounded-md hover:bg-primary/20 dark:hover:bg-primary/30 transition-colors">Nova Cifra / Artefato</button>
      </div>
      <div
        class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 flex-grow flex flex-col">
        <h3 class="font-display uppercase text-primary font-bold mb-2">Equipamento</h3>
        <div class="flex-grow overflow-y-auto h-64 pr-2 border-b border-gray-200 dark:border-gray-700 pb-2 mb-2">
          <textarea [(ngModel)]="sheet.equipment"
            class="block w-full h-full rounded-md border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-gray-900 dark:text-white"
            placeholder="Seus equipamentos"></textarea>
        </div>
        <div class="grid grid-cols-7 gap-4 mt-4">
          <div class="col-span-2">
            <label class="font-display text-sm uppercase text-primary font-bold" for="armor">Armadura</label>
            <input [(ngModel)]="sheet.armor"
              class="block w-full text-center mt-1 rounded-md border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-gray-900 dark:text-white"
              id="armor" type="number" />
          </div>
          <div class="col-span-5">
            <label class="font-display text-sm uppercase text-primary font-bold" for="money">Dinheiro</label>
            <input [(ngModel)]="sheet.money"
              class="block w-full mt-1 rounded-md border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 text-gray-900 dark:text-white"
              id="money" type="text" />
          </div>
        </div>
      </div>
    </div>
  </main>
</div>